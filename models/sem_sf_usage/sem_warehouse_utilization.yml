version: 2

semantic_models:
  - name: warehouse_utilization
    model: ref('stg_warehouse_load_history')
    description: "Warehouse concurrency and queuing metrics"

    entities:
      - name: warehouse
        type: primary
        expr: warehouse_util_name

    measures:
      - name: avg_running
        description: "Average number of running queries"
        agg: average
        expr: running_queries
        agg_time_dimension: start_time

      - name: avg_queued
        description: "Average number of queued queries"
        agg: average
        expr: queued_load
        agg_time_dimension: start_time

      - name: peak_utilization
        description: "Peak warehouse utilization percentage"
        expr: (running_queries / nullif(running_queries + queued_load, 0)) * 100
        agg: max
        agg_time_dimension: start_time

    dimensions:
      - name: start_time
        type: time
        type_params:
          time_granularity: hour
